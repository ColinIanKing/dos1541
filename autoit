.page 'autoit'
;rsr test subroutines
;
; this auto init subroutine will
; check if drvnum drive is inited
;
; if catalog calls this routine
; before any header info is transfered
; this routine works.
;
; this routine will end in error
; if any error but disk id occurs
;
autoit	ldx #$ff        ;flag for error rtn
	stx jobrtn
	jsr initsu      ;.a=drvnum< >=error
	cmp #03         ;chk missing disk
	beq catid3
catid5	cmp #2          ;chk for okay
	bcc catid4
catid2	jmp error       ;must be an error
catid3	ldy drvcnt      ;chk for single
	beq catid2
	lda #0          ;only one good drive?
	sta drvcnt
	lda drvnum      ;flip to chk other drv
	eor #1
	sta drvnum
	jmp autoit
;
catid4	txa             ;x preserved
	asl a           ;mult *8
	asl a
	asl a
	tay
	lda drvnum
	asl a
	tax
	lda hdrs,y      ;chk disk id
	cmp dskid,x     ;against old id
	bne catid1
	lda hdrs+1,y
	cmp dskid+1,x
	bne catid1
	rts             ;same id
catid1	jmp initdr      ;diff so init
;
.end
